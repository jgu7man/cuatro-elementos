<div class="container">
  <ng-container *ngIf="(table_.table$ | async) as table">
    <div class="row">
      <div class="col s12 l3">
        <h2>Mesa {{table.id}}</h2>

        <h2>Jugadores</h2>
        <mat-list *ngIf="(table_.players$ | async) as players">
          <mat-list-item *ngFor="let player of players">
            <mat-icon mat-list-icon>person</mat-icon>
            <div mat-line>{{player.nick}}</div>
            <div mat-line> Cartas {{player.deck.length}} </div>
          </mat-list-item>
        </mat-list>

        <ng-container *ngIf="table.deck">
          <div class="row">

            <ng-container *ngIf="tid | areIn | async; else asViewer">
              <div class="col s12">
                <p>Cartas disponibles: {{table.deck.length}}</p>
                <button mat-raised-button color="primary"
                matTooltip="Reiniciar partida"
                *ngIf="table.started"
                (click)="table_.restart()">
                  <mat-icon class="mat-18">restart_alt</mat-icon>
                </button>
                <button mat-button
                color="warning"
                matTooltip="Abandonar partida"
                (click)="table_.playerLeave()">
                  <mat-icon class="mat-18">logout</mat-icon>
                </button>
                <br>
                <button  *ngIf="table.colorSelected"
                mat-raised-button
                disable
                [style.backgroundColor]="table.colorSelected| cardColor: 'color'" >
                  Color elegido: {{table.colorSelected | cardColor: 'name'}}
                </button>

              </div>
            </ng-container>
            <!-- AS VIEWER -->
            <ng-template #asViewer>
              <p id="invited-message">Est√°s en esta mesa como invitado.</p>
            </ng-template>

          </div>
        </ng-container>
      </div>

      <div class="col s12 l9">

        <ng-container *ngIf="table.started; else unStarted">
          <!-- DROPPED DECK -->

          <div class="row" id="dropped-deck-container">
            <div class="col s12 dropped-deck">
              <ng-container *ngIf="table.droppedDeck.length">
                <ng-container *ngFor="let card of table.droppedDeck">
                  <app-card
                  [appWithinDeck]="table.droppedDeck.length"
                  [card]="card"
                  ></app-card>
                </ng-container>
              </ng-container>
            </div>
          </div>

          <!-- PLAYER AREA -->
          <ng-container *ngIf="(player_.current$ | async) as player">
            <div class="row" id="player-deck-container">

              <!-- PLAYER HEADER -->
              <div class="col s12">
                <p>
                  {{player.nick}}
                  <i class="fas fa-dot-circle red-text"
                  *ngIf="player.inTurn"></i>
                </p>
              </div>

              <div class="col s12 player-deck">
                <ng-container *ngFor="let card of player.deck">
                  <app-card
                  [card]="card"
                  [appWithinDeck]="player.deck.length"
                  [playerDeck]="true"
                  ></app-card>
                </ng-container>
              </div>

              <div class="col s12">
                <button *ngIf="player.inTurn"
                mat-raised-button
                color="primary"
                [disabled]="(player.deck | avaliableDrop | async)"
                (click)="table_.takeCard()" >
                  Tomar una carta
                </button>
                <!-- <button *ngIf="player.current"
                mat-raised-button
                color="accent"
                (click)="letTurn()" >
                  Pasar turno
                </button> -->

              </div>
            </div>
          </ng-container>

        </ng-container>

        <ng-template #unStarted >

          <ng-container *ngIf="tid | areIn | async; else notIn">
            <button mat-raised-button color="primary"
            (click)="table_.getStarted()"
            *ngIf="(table_.players$ | async) as players"
            [disabled]="players.length < 0"
            >Iniciar partida</button>
          </ng-container>

          <ng-template #notIn>
            <button mat-raised-button color="accent"
            (click)="addPlayer()"
            >Unirse a la mesa</button>
          </ng-template>


        </ng-template>
      </div>
    </div>
  </ng-container>
</div>
